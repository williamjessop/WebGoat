== The Attack

Exploiting the log4j vulnerability takes palace in 2 stages. Below is the string that would be sent as input to trigger the vulnerability.

image::images/attack_string.png[The Log4j Attack String,2372,520,style="lesson-image"]

Things to note:

1. The `${}` represents string replacement, this should not normally be performed on user input.
2. A JNDI call is made
3. There is a reference to an LDAP server

=== The log4j Flaw
It can be very useful to use format strings when logging, however log4j has a serious flaw when it does so. When log4j logs a string it will always search for `${}` that is can expand to more useful values. This is true even if the string was constructed with untrusted data.

This all leads to an injection style flaw where an attacker can inject `${}` into input and then cause the server to act on it. This would not be a problem on its own, but when combined with JNDI and LDAP it creates a massive vulnerability.

=== What is JNDI?

JNDI or the Java Naming and Directory Interface is a piece of Java that is responsible for converting names into more complex data. It can be thought of like a special DNS service inside of Java. (In fact JNDI can be used to make DNS queries!)

JNDI is capable of many things, one of these things is sending an LDAP query.

=== What is LDAP?

LDAP or the Lightweight Directory Access Protocol is a service that is commonly used to store and retrieve user information. In the business world it can be used for things like email servers or user authentication. LDAP servers are also able to redirect requests to HTTP servers.

There is a business use case in Java applications to execute remote objects. In a legitimate business use case one can use LDAP to download a remote Java class and execute it for some result. However, this poses a very large security risk if an attacker can control the LDAP URL. This is the second half of the cause of the log4j vulnerability.